{"version":3,"file":"RemoteClient.js","sources":["../src/parse.js","../src/AbstractClient.js","../src/terms.js","../src/RemoteClient.js"],"sourcesContent":["'use strict';\n\nconst ohm = require('ohm-js')\n\nconst grammar = ohm.grammar(`\n  G {\n\n    factOrPattern\n      = term*\n\n    term\n      = id\n      | word\n      | value\n      | variable\n      | wildcard\n      | hole\n\n    id\n      = \"#\" alnum*\n\n    value\n      = keyword<\"true\">   -- true\n      | keyword<\"false\">  -- false\n      | keyword<\"null\">   -- null\n      | number\n      | string\n\n    variable\n      = \"$\" alnum+\n\n    wildcard\n      = \"$\"\n\n    hole\n      = \"_\"\n\n    word\n      = (~special any)+  -- nonspace\n      | space+           -- space\n\n    keyword<k>\n      = k ~alnum\n\n    number\n      = float (\"e\" float)?\n\n    float\n      = integer (\".\" digit+)?\n\n    integer\n      = (\"+\" | \"-\")? digit+\n\n    string\n      = \"\\\\\"\" (~\"\\\\\"\" ~\"\\\\n\" any)* \"\\\\\"\"\n\n    special\n      = id | value | variable | wildcard | hole | space\n\n  }\n`);\n\nconst semantics = grammar.createSemantics().addOperation('parse', {\n  factOrPattern(terms) {\n    return terms.parse();\n  },\n  id(_, cs) {\n    return {id: cs.sourceString};\n  },\n  value_true(_) {\n    return {value: true};\n  },\n  value_false(_) {\n    return {value: false};\n  },\n  value_null(_) {\n    return {value: null};\n  },\n  variable(_, cs) {\n    return {variable: cs.sourceString};\n  },\n  wildcard(_) {\n    return {wildcard: true};\n  },\n  hole(_) {\n    return {hole: true};\n  },\n  word_nonspace(_) {\n    return {word: this.sourceString};\n  },\n  word_space(_) {\n    return {word: ' '};\n  },\n  number(_1, _2, _3) {\n    return {value: parseFloat(this.sourceString)};\n  },\n  string(_oq, cs, _cq) {\n    const chars = [];\n    let idx = 0;\n    cs = cs.parse();\n    while (idx < cs.length) {\n      let c = cs[idx++];\n      if (c === '\\\\' && idx < cs.length) {\n        c = cs[idx++];\n        switch (c) {\n          case 'n': c = '\\n'; break;\n          case 't': c = '\\t'; break;\n          default: idx--;\n        }\n      }\n      chars.push(c);\n    }\n    return {value: chars.join('')};\n  },\n  _terminal() {\n    return this.sourceString;\n  }\n});\n\nexport default function parse(str, optRule) {\n  const rule = optRule || 'factOrPattern';\n  const matchResult = grammar.match(str.trim(), rule);\n  if (matchResult.succeeded()) {\n    return semantics(matchResult).parse();\n  } else {\n    throw new Error(`invalid ${rule}: ${str}`);\n  }\n};\n","'use strict';\n\nimport parse from './parse'\n\nconst MAX_PARSE_CACHE_SIZE = 1000;\n\nexport default class AbstractClient {\n  constructor(id) {\n    this._id = id;\n    this._parseCache = new Map();\n    this._asserts = [];\n    this._retracts = [];\n  }\n\n  assert(factString, ...fillerValues) {\n    const fact = this._toJSONFactOrPattern(factString, ...fillerValues);\n    this._asserts.push(fact);\n  }\n\n  retract(patternString, ...fillerValues) {\n    const pattern = this._toJSONFactOrPattern(patternString, ...fillerValues);\n    this._retracts.push(pattern);\n  }\n\n  async flushChanges() {\n    throw new Error('subclass responsibility');\n  }\n\n  async immediatelyAssert(factString, ...fillerValues) {\n    this.assert(factString, ...fillerValues);\n    await this.flushChanges();\n  }\n\n  async immediatelyRetract(patternString, ...fillerValues) {\n    this.assert(patternString, ...fillerValues);\n    await this.flushChanges();\n  }\n\n  async immediatelyRetractEverythingAbout(name) {\n    throw new Error('subclass responsibility');\n  }\n\n  async immediatelyRetractEverythingAssertedByMe() {\n    throw new Error('subclass responsibility');\n  }\n\n  async getAllFacts() {\n    throw new Error('subclass responsibility');\n  }\n\n  _toJSONFactOrPattern(factOrPatternString, ...fillerValues) {\n    if (arguments.length === 0) {\n      throw new Error('not enough arguments!');\n    }\n    if (typeof factOrPatternString !== 'string') {\n      throw new Error('factOrPatternString must be a string!');\n    }\n    let terms = this._parse(factOrPatternString);\n    if (fillerValues.length > 0) {\n      terms = terms.slice();\n    }\n    for (let idx = 0; idx < terms.length; idx++) {\n      const term = terms[idx];\n      if (term.hasOwnProperty('hole')) {\n        if (fillerValues.length === 0) {\n          throw new Error('not enough filler values!');\n        }\n        terms[idx] = this._toJSONTerm(fillerValues.shift());\n      }\n    }\n    if (fillerValues.length > 0) {\n      throw new Error('too many filler values!');\n    }\n    return terms;\n  }\n\n  _toJSONTerm(value) {\n    return {value: value};\n  }\n\n  _parse(factOrPatternString) {\n    if (this._parseCache.has(factOrPatternString)) {\n      return this._parseCache.get(factOrPatternString);\n    } else {\n      this._clearParseCacheIfTooBig();\n      const terms = parse(factOrPatternString);\n      this._parseCache.set(factOrPatternString, terms);\n      return terms;\n    }\n  }\n\n  _clearParseCacheIfTooBig() {\n    if (this._parseCache.size > MAX_PARSE_CACHE_SIZE) {\n      this.clearParseCache();\n    }\n  }\n\n  clearParseCache() {\n    this._parseCache.clear();\n  }\n}\n","'use strict';\n\nclass Term {\n  toString() {\n    throw new Error('subclass responsibility');\n  }\n\n  toJSON() {\n    throw new Error('subclass responsibility');\n  }\n\n  toRawValue() {\n    throw new Error('subclass responsibility');\n  }\n\n  match(that, env) {\n    throw new Error('subclass responsibility');\n  }\n}\n\nTerm.fromJSON = json => {\n  if (json.hasOwnProperty('id')) {\n    return new Id(json.id);\n  } else if (json.hasOwnProperty('word')) {\n    return new Word(json.word);\n  } else if (json.hasOwnProperty('value')) {\n    return new Value(json.value);\n  } else if (json.hasOwnProperty('blobRef')) {\n    return new BlobRef(json.blobRef);\n  } else if (json.hasOwnProperty('variable')) {\n    return new Variable(json.variable);\n  } else if (json.hasOwnProperty('wildcard')) {\n    return new Wildcard();\n  } else if (json.hasOwnProperty('hole')) {\n    return new Hole();\n  } else {\n    throw new Error('unrecognized JSON term: ' + JSON.stringify(json));\n  }\n};\n\nclass Id extends Term {\n  constructor(name) {\n    super();\n    this.name = name;\n  }\n\n  toString() {\n    return '#' + this.name;\n  }\n\n  toJSON() {\n    return {id: this.name};\n  }\n\n  toRawValue() {\n    return this;\n  }\n\n  match(that, env) {\n    return that instanceof Id && this.name === that.name ?\n        env :\n        null;\n  }\n}\n\nclass Word extends Term {\n  constructor(value) {\n    super();\n    this.value = value;\n  }\n\n  toString() {\n    return this.value;\n  }\n\n  toJSON() {\n    return {word: this.value};\n  }\n\n  toRawValue() {\n    return this;\n  }\n\n  match(that, env) {\n    return that instanceof Word && this.value === that.value ?\n        env :\n        null;\n  }\n}\n\nclass Value extends Term {\n  constructor(value) {\n    super();\n    this.value = value;\n  }\n\n  toString() {\n    return JSON.stringify(this.value);\n  }\n\n  toJSON() {\n    return {value: this.value};\n  }\n\n  toRawValue() {\n    return this.value;\n  }\n\n  match(that, env) {\n    return that instanceof Value && this.value === that.value ?\n        env :\n        null;\n  }\n}\n\nclass BlobRef extends Term {\n  constructor(id) {\n    super();\n    this.id = id;\n  }\n\n  toString() {\n    return '@' + this.id;\n  }\n\n  toJSON() {\n    return {blobRef: this.id};\n  }\n\n  toRawValue() {\n    return this;\n  }\n\n  match(that, env) {\n    return that instanceof BlobRef && this.id === that.id ?\n        env :\n        null;\n  }\n}\n\nclass Variable extends Term {\n  constructor(name) {\n    super();\n    this.name = name;\n  }\n\n  toString() {\n    return '$' + this.name;\n  }\n\n  toJSON() {\n    return {variable: this.name};\n  }\n\n  toRawValue() {\n    throw new Error('Variable\\'s toRawValue() should never be called!');\n  }\n\n  match(that, env) {\n    if (env[this.name] === undefined) {\n      env[this.name] = that;\n      return env;\n    } else {\n      return env[this.name].match(that, env);\n    }\n  }\n}\n\nclass Wildcard extends Term {\n  constructor() {\n    super();\n    // no-op\n  }\n\n  toString() {\n    return '$';\n  }\n\n  toJSON() {\n    return {wildcard: true};\n  }\n\n  toRawValue() {\n    throw new Error('Wildcard\\'s toRawValue() should never be called!');\n  }\n\n  match(that, env) {\n    return env;\n  }\n}\n\nclass Hole extends Term {\n  constructor() {\n    super();\n    // no-op\n  }\n\n  toString() {\n    return '_';\n  }\n\n  toJSON() {\n    return {hole: true};\n  }\n\n  toRawValue() {\n    throw new Error('Hole\\'s toRawValue() should never be called!');\n  }\n\n  match(that, env) {\n    throw new Error('Hole\\'s match() should never be called!');\n  }\n}\n\nexport {\n  Term,\n  Id,\n  Word,\n  Value,\n  BlobRef,\n  Variable,\n  Wildcard,\n  Hole\n}\n","'use strict';\n\nimport AbstractClient from './AbstractClient'\nimport {Term} from './terms'\nimport parse from './parse'\n\n// If fetch is not declared, load it from the node-fetch module.\n// (This makes it possible to run RemoteClient in the browser and in node-js.)\nconst fetch = (() => {\n  try {\n    return fetch;\n  } catch (e) {\n    return require('node-fetch');\n  }\n})();\n\nexport default class RemoteClient extends AbstractClient {\n  constructor(address, port, id) {\n    super(id);\n    this._address = address;\n    this._port = port;\n  }\n\n  select(...patternStrings) {\n    const patterns = patternStrings.map(p =>\n      p instanceof Array ?\n          this._toJSONFactOrPattern(...p) :\n          this._toJSONFactOrPattern(p));\n    const solutions = async () => {\n      const params = `query=${JSON.stringify(patterns)}`;\n      const response = await fetch(`http://${this._address}:${this._port}/facts?${params}`);\n      return await response.json();\n    };\n    const results = {\n      async do(callbackFn) {\n        for (let solution of await solutions()) {\n          for (let name in solution) {\n            // force serialization and deserialization to simulate going over the network\n            const json = JSON.parse(JSON.stringify(solution[name]));\n            solution[name] = Term.fromJSON(json).toRawValue();\n          }\n          await callbackFn(solution);\n        }\n        return results;\n      },\n      async count() {\n        return (await solutions()).length;\n      },\n      async isEmpty() {\n        return (await solutions()).length === 0;\n      },\n      async isNotEmpty() {\n        return (await solutions()).length > 0;\n      }\n    };\n    return results;\n  }\n\n  async flushChanges() {\n    const retractions = this._retracts;\n    const assertions = this._asserts;\n    this._retracts = [];\n    this._asserts = [];\n    const params =\n        'clientId=' + this._id + '&' +\n        'retractions=' + JSON.stringify(retractions) + '&' +\n        'assertions=' + JSON.stringify(assertions);\n    const response = await fetch(\n        `http://${this._address}:${this._port}/facts?${params}`,\n        {method: 'PUT'});\n    return await response.json();\n  }\n\n  async immediatelyRetractEverythingAbout(name) {\n    const response = await fetch(\n        `http://${this._address}:${this._port}/facts?clientId=${this._id}&name=${name}`,\n        {method: 'DELETE'});\n    return await response.json();\n  }\n\n  async immediatelyRetractEverythingAssertedByMe() {\n    const response = await fetch(\n        `http://${this._address}:${this._port}/facts?clientId=${this._id}`,\n        {method: 'DELETE'});\n    return await response.json();\n  }\n\n  async getAllFacts() {\n    const response = await fetch(`http://${this._address}:${this._port}/facts`);\n    return await response.json();\n  }\n\n  toString() {\n    return `[RemoteClient ${this._address}:${this._port}, ${this._id}]`;\n  }\n}\n\nmodule.exports = RemoteClient;\n"],"names":[],"mappings":";;;;;;AAEA,MAAM,GAAG,GAAG,OAAO,CAAC,QAAQ,EAAC;;AAE7B,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwD7B,CAAC,CAAC,CAAC;;AAEH,MAAM,SAAS,GAAG,OAAO,CAAC,eAAe,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE;EAChE,aAAa,CAAC,KAAK,EAAE;IACnB,OAAO,KAAK,CAAC,KAAK,EAAE,CAAC;GACtB;EACD,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE;IACR,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,YAAY,CAAC,CAAC;GAC9B;EACD,UAAU,CAAC,CAAC,EAAE;IACZ,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;GACtB;EACD,WAAW,CAAC,CAAC,EAAE;IACb,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;GACvB;EACD,UAAU,CAAC,CAAC,EAAE;IACZ,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;GACtB;EACD,QAAQ,CAAC,CAAC,EAAE,EAAE,EAAE;IACd,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,YAAY,CAAC,CAAC;GACpC;EACD,QAAQ,CAAC,CAAC,EAAE;IACV,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;GACzB;EACD,IAAI,CAAC,CAAC,EAAE;IACN,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;GACrB;EACD,aAAa,CAAC,CAAC,EAAE;IACf,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;GAClC;EACD,UAAU,CAAC,CAAC,EAAE;IACZ,OAAO,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;GACpB;EACD,MAAM,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE;IACjB,OAAO,CAAC,KAAK,EAAE,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;GAC/C;EACD,MAAM,CAAC,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE;IACnB,MAAM,KAAK,GAAG,EAAE,CAAC;IACjB,IAAI,GAAG,GAAG,CAAC,CAAC;IACZ,EAAE,GAAG,EAAE,CAAC,KAAK,EAAE,CAAC;IAChB,OAAO,GAAG,GAAG,EAAE,CAAC,MAAM,EAAE;MACtB,IAAI,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;MAClB,IAAI,CAAC,KAAK,IAAI,IAAI,GAAG,GAAG,EAAE,CAAC,MAAM,EAAE;QACjC,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;QACd,QAAQ,CAAC;UACP,KAAK,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,MAAM;UAC1B,KAAK,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,MAAM;UAC1B,SAAS,GAAG,EAAE,CAAC;SAChB;OACF;MACD,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACf;IACD,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;GAChC;EACD,SAAS,GAAG;IACV,OAAO,IAAI,CAAC,YAAY,CAAC;GAC1B;CACF,CAAC,CAAC;;AAEH,AAAe,SAAS,KAAK,CAAC,GAAG,EAAE,OAAO,EAAE;EAC1C,MAAM,IAAI,GAAG,OAAO,IAAI,eAAe,CAAC;EACxC,MAAM,WAAW,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,EAAE,IAAI,CAAC,CAAC;EACpD,IAAI,WAAW,CAAC,SAAS,EAAE,EAAE;IAC3B,OAAO,SAAS,CAAC,WAAW,CAAC,CAAC,KAAK,EAAE,CAAC;GACvC,MAAM;IACL,MAAM,IAAI,KAAK,CAAC,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;GAC5C;CACF;;AC3HD,MAAM,oBAAoB,GAAG,IAAI,CAAC;;AAElC,AAAe,MAAM,cAAc,CAAC;EAClC,WAAW,CAAC,EAAE,EAAE;IACd,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;IACd,IAAI,CAAC,WAAW,GAAG,IAAI,GAAG,EAAE,CAAC;IAC7B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACnB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;GACrB;;EAED,MAAM,CAAC,UAAU,EAAE,GAAG,YAAY,EAAE;IAClC,MAAM,IAAI,GAAG,IAAI,CAAC,oBAAoB,CAAC,UAAU,EAAE,GAAG,YAAY,CAAC,CAAC;IACpE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;GAC1B;;EAED,OAAO,CAAC,aAAa,EAAE,GAAG,YAAY,EAAE;IACtC,MAAM,OAAO,GAAG,IAAI,CAAC,oBAAoB,CAAC,aAAa,EAAE,GAAG,YAAY,CAAC,CAAC;IAC1E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;GAC9B;;EAED,MAAM,YAAY,GAAG;IACnB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,MAAM,iBAAiB,CAAC,UAAU,EAAE,GAAG,YAAY,EAAE;IACnD,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE,GAAG,YAAY,CAAC,CAAC;IACzC,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;GAC3B;;EAED,MAAM,kBAAkB,CAAC,aAAa,EAAE,GAAG,YAAY,EAAE;IACvD,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,GAAG,YAAY,CAAC,CAAC;IAC5C,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;GAC3B;;EAED,MAAM,iCAAiC,CAAC,IAAI,EAAE;IAC5C,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,MAAM,wCAAwC,GAAG;IAC/C,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,MAAM,WAAW,GAAG;IAClB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,oBAAoB,CAAC,mBAAmB,EAAE,GAAG,YAAY,EAAE;IACzD,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE;MAC1B,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC;KAC1C;IACD,IAAI,OAAO,mBAAmB,KAAK,QAAQ,EAAE;MAC3C,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;KAC1D;IACD,IAAI,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC;IAC7C,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;MAC3B,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;KACvB;IACD,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,KAAK,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE;MAC3C,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC;MACxB,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;QAC/B,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;UAC7B,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;SAC9C;QACD,KAAK,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC,CAAC;OACrD;KACF;IACD,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;MAC3B,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;KAC5C;IACD,OAAO,KAAK,CAAC;GACd;;EAED,WAAW,CAAC,KAAK,EAAE;IACjB,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;GACvB;;EAED,MAAM,CAAC,mBAAmB,EAAE;IAC1B,IAAI,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,mBAAmB,CAAC,EAAE;MAC7C,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;KAClD,MAAM;MACL,IAAI,CAAC,wBAAwB,EAAE,CAAC;MAChC,MAAM,KAAK,GAAG,KAAK,CAAC,mBAAmB,CAAC,CAAC;MACzC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAC;MACjD,OAAO,KAAK,CAAC;KACd;GACF;;EAED,wBAAwB,GAAG;IACzB,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,GAAG,oBAAoB,EAAE;MAChD,IAAI,CAAC,eAAe,EAAE,CAAC;KACxB;GACF;;EAED,eAAe,GAAG;IAChB,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC;GAC1B;CACF;;AClGD,MAAM,IAAI,CAAC;EACT,QAAQ,GAAG;IACT,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,MAAM,GAAG;IACP,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,UAAU,GAAG;IACX,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;GAC5C;CACF;;AAED,IAAI,CAAC,QAAQ,GAAG,IAAI,IAAI;EACtB,IAAI,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;IAC7B,OAAO,IAAI,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;GACxB,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;IACtC,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;GAC5B,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;IACvC,OAAO,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GAC9B,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;IACzC,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;GAClC,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;IAC1C,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;GACpC,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;IAC1C,OAAO,IAAI,QAAQ,EAAE,CAAC;GACvB,MAAM,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE;IACtC,OAAO,IAAI,IAAI,EAAE,CAAC;GACnB,MAAM;IACL,MAAM,IAAI,KAAK,CAAC,0BAA0B,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;GACpE;CACF,CAAC;;AAEF,MAAM,EAAE,SAAS,IAAI,CAAC;EACpB,WAAW,CAAC,IAAI,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;EAED,QAAQ,GAAG;IACT,OAAO,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;GACxB;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;GACxB;;EAED,UAAU,GAAG;IACX,OAAO,IAAI,CAAC;GACb;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,OAAO,IAAI,YAAY,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI;QAChD,GAAG;QACH,IAAI,CAAC;GACV;CACF;;AAED,MAAM,IAAI,SAAS,IAAI,CAAC;EACtB,WAAW,CAAC,KAAK,EAAE;IACjB,KAAK,EAAE,CAAC;IACR,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;GACpB;;EAED,QAAQ,GAAG;IACT,OAAO,IAAI,CAAC,KAAK,CAAC;GACnB;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;GAC3B;;EAED,UAAU,GAAG;IACX,OAAO,IAAI,CAAC;GACb;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,OAAO,IAAI,YAAY,IAAI,IAAI,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK;QACpD,GAAG;QACH,IAAI,CAAC;GACV;CACF;;AAED,MAAM,KAAK,SAAS,IAAI,CAAC;EACvB,WAAW,CAAC,KAAK,EAAE;IACjB,KAAK,EAAE,CAAC;IACR,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;GACpB;;EAED,QAAQ,GAAG;IACT,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;GACnC;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;GAC5B;;EAED,UAAU,GAAG;IACX,OAAO,IAAI,CAAC,KAAK,CAAC;GACnB;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,OAAO,IAAI,YAAY,KAAK,IAAI,IAAI,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK;QACrD,GAAG;QACH,IAAI,CAAC;GACV;CACF;;AAED,MAAM,OAAO,SAAS,IAAI,CAAC;EACzB,WAAW,CAAC,EAAE,EAAE;IACd,KAAK,EAAE,CAAC;IACR,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;GACd;;EAED,QAAQ,GAAG;IACT,OAAO,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC;GACtB;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;GAC3B;;EAED,UAAU,GAAG;IACX,OAAO,IAAI,CAAC;GACb;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,OAAO,IAAI,YAAY,OAAO,IAAI,IAAI,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE;QACjD,GAAG;QACH,IAAI,CAAC;GACV;CACF;;AAED,MAAM,QAAQ,SAAS,IAAI,CAAC;EAC1B,WAAW,CAAC,IAAI,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;GAClB;;EAED,QAAQ,GAAG;IACT,OAAO,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC;GACxB;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;GAC9B;;EAED,UAAU,GAAG;IACX,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;GACrE;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE;MAChC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;MACtB,OAAO,GAAG,CAAC;KACZ,MAAM;MACL,OAAO,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;KACxC;GACF;CACF;;AAED,MAAM,QAAQ,SAAS,IAAI,CAAC;EAC1B,WAAW,GAAG;IACZ,KAAK,EAAE,CAAC;;GAET;;EAED,QAAQ,GAAG;IACT,OAAO,GAAG,CAAC;GACZ;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;GACzB;;EAED,UAAU,GAAG;IACX,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;GACrE;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,OAAO,GAAG,CAAC;GACZ;CACF;;AAED,MAAM,IAAI,SAAS,IAAI,CAAC;EACtB,WAAW,GAAG;IACZ,KAAK,EAAE,CAAC;;GAET;;EAED,QAAQ,GAAG;IACT,OAAO,GAAG,CAAC;GACZ;;EAED,MAAM,GAAG;IACP,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;GACrB;;EAED,UAAU,GAAG;IACX,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;GACjE;;EAED,KAAK,CAAC,IAAI,EAAE,GAAG,EAAE;IACf,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;GAC5D;CACF;;AC9MD;;AAEA,MAAM,KAAK,GAAG,CAAC,MAAM;EACnB,IAAI;IACF,OAAO,KAAK,CAAC;GACd,CAAC,OAAO,CAAC,EAAE;IACV,OAAO,OAAO,CAAC,YAAY,CAAC,CAAC;GAC9B;CACF,GAAG,CAAC;;AAEL,AAAe,MAAM,YAAY,SAAS,cAAc,CAAC;EACvD,WAAW,CAAC,OAAO,EAAE,IAAI,EAAE,EAAE,EAAE;IAC7B,KAAK,CAAC,EAAE,CAAC,CAAC;IACV,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;IACxB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;GACnB;;EAED,MAAM,CAAC,GAAG,cAAc,EAAE;IACxB,MAAM,QAAQ,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC;MACnC,CAAC,YAAY,KAAK;UACd,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC;UAC/B,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC;IACpC,MAAM,SAAS,GAAG,YAAY;MAC5B,MAAM,MAAM,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;MACnD,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC;MACtF,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;KAC9B,CAAC;IACF,MAAM,OAAO,GAAG;MACd,MAAM,EAAE,CAAC,UAAU,EAAE;QACnB,KAAK,IAAI,QAAQ,IAAI,MAAM,SAAS,EAAE,EAAE;UACtC,KAAK,IAAI,IAAI,IAAI,QAAQ,EAAE;;YAEzB,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACxD,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,UAAU,EAAE,CAAC;WACnD;UACD,MAAM,UAAU,CAAC,QAAQ,CAAC,CAAC;SAC5B;QACD,OAAO,OAAO,CAAC;OAChB;MACD,MAAM,KAAK,GAAG;QACZ,OAAO,CAAC,MAAM,SAAS,EAAE,EAAE,MAAM,CAAC;OACnC;MACD,MAAM,OAAO,GAAG;QACd,OAAO,CAAC,MAAM,SAAS,EAAE,EAAE,MAAM,KAAK,CAAC,CAAC;OACzC;MACD,MAAM,UAAU,GAAG;QACjB,OAAO,CAAC,MAAM,SAAS,EAAE,EAAE,MAAM,GAAG,CAAC,CAAC;OACvC;KACF,CAAC;IACF,OAAO,OAAO,CAAC;GAChB;;EAED,MAAM,YAAY,GAAG;IACnB,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC;IACnC,MAAM,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC;IACjC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACpB,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;IACnB,MAAM,MAAM;QACR,WAAW,GAAG,IAAI,CAAC,GAAG,GAAG,GAAG;QAC5B,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,GAAG,GAAG;QAClD,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;IAC/C,MAAM,QAAQ,GAAG,MAAM,KAAK;QACxB,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QACvD,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;IACrB,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;GAC9B;;EAED,MAAM,iCAAiC,CAAC,IAAI,EAAE;IAC5C,MAAM,QAAQ,GAAG,MAAM,KAAK;QACxB,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAC/E,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC;IACxB,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;GAC9B;;EAED,MAAM,wCAAwC,GAAG;IAC/C,MAAM,QAAQ,GAAG,MAAM,KAAK;QACxB,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;QAClE,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC;IACxB,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;GAC9B;;EAED,MAAM,WAAW,GAAG;IAClB,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,CAAC,OAAO,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;IAC5E,OAAO,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;GAC9B;;EAED,QAAQ,GAAG;IACT,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;GACrE;CACF;;AAED,MAAM,CAAC,OAAO,GAAG,YAAY,CAAC;;;;;;;;"}